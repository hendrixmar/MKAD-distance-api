from shapely.geometry import Polygon, Point
import csv
import os
import pytest

MKAD_POINTS = [(37.592099, 55.576016),
			   (37.568613, 55.582226),
			   (37.54767, 55.586301),
			   (37.535653, 55.589987),
			   (37.521577, 55.593091),
			   (37.509217, 55.597165),
			   (37.49926, 55.604342),
			   (37.48999, 55.612099),
			   (37.479691, 55.621405),
			   (37.469048, 55.630709),
			   (37.459091, 55.638849),
			   (37.449478, 55.646986),
			   (37.440895, 55.653767),
			   (37.432999, 55.660933),
			   (37.425789, 55.668679),
			   (37.419952, 55.677972),
			   (37.414116, 55.687262),
			   (37.407593, 55.696164),
			   (37.40004, 55.702355),
			   (37.391457, 55.707965),
			   (37.38562, 55.713381),
			   (37.381156, 55.72363),
			   (37.37429, 55.733876),
			   (37.369827, 55.743927),
			   (37.368796, 55.754554),
			   (37.367766, 55.763827),
			   (37.369139, 55.773097),
			   (37.370856, 55.784296),
			   (37.376005, 55.793947),
			   (37.383901, 55.803404),
			   (37.391111, 55.814594),
			   (37.394202, 55.826745),
			   (37.396262, 55.836771),
			   (37.391799, 55.845639),
			   (37.394545, 55.856431),
			   (37.404844, 55.866643),
			   (37.414113, 55.872422),
			   (37.426473, 55.875889),
			   (37.438146, 55.87974),
			   (37.445699, 55.883014),
			   (37.463551, 55.883592),
			   (37.481404, 55.886288),
			   (37.49548, 55.891101),
			   (37.508527, 55.897261),
			   (37.522603, 55.903036),
			   (37.536336, 55.90727),
			   (37.556934, 55.909387),
			   (37.575474, 55.910926),
			   (37.588864, 55.909964),
			   (37.601224, 55.906307),
			   (37.615986, 55.902073),
			   (37.631436, 55.898609),
			   (37.646885, 55.896684),
			   (37.662678, 55.895336),
			   (37.679158, 55.894566),
			   (37.696324, 55.893796),
			   (37.7104, 55.891294),
			   (37.721044, 55.88571),
			   (37.733403, 55.879163),
			   (37.745763, 55.872614),
			   (37.758122, 55.86568),
			   (37.771855, 55.859129),
			   (37.782499, 55.853926),
			   (37.794515, 55.848144),
			   (37.805501, 55.841591),
			   (37.817861, 55.83465),
			   (37.829534, 55.828673),
			   (37.837087, 55.823466),
			   (37.839835, 55.814594),
			   (37.840178, 55.806298),
			   (37.840522, 55.796842),
			   (37.841551, 55.789701),
			   (37.842238, 55.779083),
			   (37.843611, 55.769814),
			   (37.843268, 55.759964),
			   (37.842925, 55.750304),
			   (37.842582, 55.740255),
			   (37.841208, 55.729043),
			   (37.838805, 55.717055),
			   (37.835029, 55.705644),
			   (37.830566, 55.693648),
			   (37.830222, 55.68223),
			   (37.835371, 55.673325),
			   (37.838118, 55.663063),
			   (37.838118, 55.653767),
			   (37.828163, 55.646212),
			   (37.818207, 55.638267),
			   (37.806191, 55.631097),
			   (37.792115, 55.622762),
			   (37.774606, 55.613456),
			   (37.75538, 55.60376),
			   (37.733408, 55.592703),
			   (37.714868, 55.584943),
			   (37.692896, 55.577374),
			   (37.678475, 55.572328),
			   (37.65822, 55.572328),
			   (37.637278, 55.572716),
			   (37.615992, 55.574463)]

MKAD_REGION = Polygon(MKAD_POINTS)

def test_answer():
	cwd = os.getcwd()

	with open(f"{cwd}\\app\\test\\locations_test.csv") as test_cases:
		csv_reader = csv.reader(test_cases, delimiter=',')
		counter = 1
		for x, y, expected_result in csv_reader:
			x, y, expected_result = float(x), float(y), "True" == expected_result

			point = Point(x, y)
			if point.within(MKAD_REGION) != expected_result:
				pytest.fail(f"Test case {counter}: {x},{y}\n expected result: {expected_result}")

			counter += 1
